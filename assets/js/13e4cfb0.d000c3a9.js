"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5192],{1615:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>l,frontMatter:()=>t,metadata:()=>s,toc:()=>r});var c=a(5893),i=a(1151);const t={sidebar_position:4,description:"Learn how to create and call commands programmatically."},o="Commands",s={id:"developer-guide/commands",title:"Commands",description:"Learn how to create and call commands programmatically.",source:"@site/docs/developer-guide/commands.md",sourceDirName:"developer-guide",slug:"/developer-guide/commands",permalink:"/docs/developer-guide/commands",draft:!1,unlisted:!1,editUrl:"https://github.com/pragtical/pragtical.github.io/edit/main/docs/developer-guide/commands.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,description:"Learn how to create and call commands programmatically."},sidebar:"tutorialSidebar",previous:{title:"Simple Plugin",permalink:"/docs/developer-guide/simple-plugin"},next:{title:"Managing Keyboard Shortcuts",permalink:"/docs/developer-guide/managing-keyboard-shortcuts"}},d={},r=[{value:"Adding commands",id:"adding-commands",level:3},{value:"Running commands",id:"running-commands",level:3},{value:"Utility functions",id:"utility-functions",level:3}];function m(e){const n={code:"code",h1:"h1",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h1,{id:"commands",children:"Commands"}),"\n",(0,c.jsx)(n.p,{children:"As explained in the User Guide, a lot of Pragtical's functionalities\nare implemented as commands."}),"\n",(0,c.jsx)(n.p,{children:"Each command has a predicate \u2014 a condition to check if Pragtical should\nrun the command.\nThe predicate will return a boolean and other values to be consumed\nby the command function."}),"\n",(0,c.jsxs)(n.p,{children:["The simplest command is a class.\nThis tells Pragtical to check whether the current view is an instance of\na class.\nFor instance, one can pass ",(0,c.jsx)(n.code,{children:"DocView"})," as a predicate so that the command\nonly runs if the user is editing a document."]}),"\n",(0,c.jsxs)(n.p,{children:["A simpler form of the predicate above is a string that specifies the\nmodule to import.\nPragtical will import the module and checks whether the current view\nis an instance of the module.\nTo simplify our previous example, we can simply pass ",(0,c.jsx)(n.code,{children:"core.docview"}),"\nas a predicate to avoid importing ",(0,c.jsx)(n.code,{children:"DocView"})," ourselves."]}),"\n",(0,c.jsxs)(n.p,{children:["The string predicate also supports strict checking \u2014\nwhen the module name ends with ",(0,c.jsx)(n.code,{children:"!"}),", Pragtical will check whether the\ncurrent view is an instance of the class and not it's child classes.\nFor instance, passing ",(0,c.jsx)(n.code,{children:"core.view"})," will match ",(0,c.jsx)(n.code,{children:"DocView"})," as well as ",(0,c.jsx)(n.code,{children:"CommandView"}),",\nbut passing ",(0,c.jsx)(n.code,{children:"core.view!"})," will only match ",(0,c.jsx)(n.code,{children:"View"})," and not ",(0,c.jsx)(n.code,{children:"DocView"}),"."]}),"\n",(0,c.jsx)(n.p,{children:"The class and string predicates returns a boolean, the current view\nand other values passed into the predicate."}),"\n",(0,c.jsxs)(n.p,{children:["Lastly, the predicate could also be a function.\nThis function accepts a variable number of arguments, pass\nthrough ",(0,c.jsx)(n.code,{children:"command.add()"})," and returns a boolean and other values.\nIf the function returns true, the command will be executed.\nOther values are passed into the command function as arguments.\nFor instance, we can create a predicate like this instead of passing\n",(0,c.jsx)(n.code,{children:"DocView"})," as a predicate:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-lua",children:"local function predicate()\n  return core.current_view:is(DocView)\nend\n"})}),"\n",(0,c.jsx)(n.h3,{id:"adding-commands",children:"Adding commands"}),"\n",(0,c.jsxs)(n.p,{children:["To add a command, use ",(0,c.jsx)(n.code,{children:"command.add()"}),"."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-lua",children:"local type function Predicate(any...): boolean\n\nfunction command.add(predicate: Predicate | string | Object,\n                      commands: {string, Predicate}): () end\n"})}),"\n",(0,c.jsxs)(n.p,{children:["The first argument to ",(0,c.jsx)(n.code,{children:"command.add()"})," is the predicate.\nThis predicate is set for each command passed to ",(0,c.jsx)(n.code,{children:"command.add()"}),".\nIf no predicates are required, ",(0,c.jsx)(n.code,{children:"nil"})," can be passed.\nThe second parameter is a table of functions mapped to each command."]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Example:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-lua",children:'local command = require "core.command"\nlocal DocView = require "core.docview"\n\n-- add "test:print-message" which prints a message to stdout\n-- this command will be available at all times\ncommand.add(nil, { ["test:print-message"] = function() core.log("Hello world!") end })\n\n-- a predicate function\nlocal function docview_predicate(custom_msg)\n  return core.active_view:is(DocView), core.active_view, true, custom_msg\nend\n\nlocal function print_doc_name(dv, custom_predicate, custom_msg)\n  if not custom_msg then\n    custom_msg = custom_predicate and "custom predicate used!: %s" or "name: %s"\n  end\n  core.log(custom_msg, dv.doc.filename)\nend\n\n-- add "test:print-doc-name" which prints the name of currently opened file\n-- This command will only be available if the user is editing a document.\n-- this will log "custom predicate used!: <filename>"\ncommand.add(docview_predicate, { ["test:print-doc-name"] = print_doc_name })\n\n-- the line above can be simplified into this\n-- this will log "name: <filename>"\ncommand.add(DocView, { ["test:print-doc-name"] = print_doc_name })\n\n-- the line above can be simplified into this, removing a require\n-- this will log "name: <filename>"\ncommand.add("core.docview", { ["test:print-doc-name"] = print_doc_name })\n\n-- if you have subclasses of DocView and don\'t want to match them,\n-- append a exclamation mark at the end.\n-- this will log "name: <filename>"\ncommand.add("core.docview!", { ["test:print-doc-name"] = print_doc_name })\n'})}),"\n",(0,c.jsx)(n.h3,{id:"running-commands",children:"Running commands"}),"\n",(0,c.jsxs)(n.p,{children:["Users can run these commands via the command palette while\nplugins can run these commands programmatically via ",(0,c.jsx)(n.code,{children:"command.perform()"}),"."]}),"\n",(0,c.jsxs)(n.p,{children:["If you want to check whether a command can run without running the command,\n(the command exists and the predicate passed),\nyou can use ",(0,c.jsx)(n.code,{children:"command.is_valid()"}),"."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-lua",children:"function command.perform(cmd: string, ...: any): boolean end\nfunction command.is_valid(cmd: string, ...: any): boolean end\n"})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"command.perform()"})," accepts a command as the first parameter.\nIf the command requires other parameters, it can be passed into\n",(0,c.jsx)(n.code,{children:"command.perform()"}),".\nIf a command is found and executed successfully, the function\nreturns ",(0,c.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Example:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-lua",children:'local command = require "core.command"\n\n-- open the command prompt\ncommand.perform "core:find-command"\n\n-- assuming we\'ve run the code in the section above,\n-- we can try passing a custom message via command:perform!\ncommand.perform("test:print-doc-name", "custom message! %s")\n\n-- command palette should be accessible all the time\n-- prints true\nprint(command.is_valid "core:find-command")\n'})}),"\n",(0,c.jsx)(n.h3,{id:"utility-functions",children:"Utility functions"}),"\n",(0,c.jsxs)(n.p,{children:["To get a prettified name of a command, shown in the command palette,\nuse ",(0,c.jsx)(n.code,{children:"command.prettify_name()"}),"."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-lua",children:"function command.prettify_name(name: string): string end\n"})}),"\n",(0,c.jsx)(n.p,{children:"The function accepts a command-like string and returns a prettified\ncommand string.\nAll the dashes are replaced with spaces and the first letter of\nall words are capitalized."})]})}function l(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(m,{...e})}):m(e)}},1151:(e,n,a)=>{a.d(n,{Z:()=>s,a:()=>o});var c=a(7294);const i={},t=c.createContext(i);function o(e){const n=c.useContext(t);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),c.createElement(t.Provider,{value:n},e.children)}}}]);