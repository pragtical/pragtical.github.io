---
slug: pragtical-v382-release
title: Pragtical v3.8.2 Release
authors: jgmdev
---

Another month, another release accompanied with the usual bug fixes, additional
enhancements and CI build system improvements. Salted with a pinch of
new features in order to keep the flavor going on!

<!-- truncate -->

## Views State Support

This release adds support for saving and loading a View state explicitly,
allowing to properly load them on subsequent editor launches. This change
introduces the following new methods that can be implemented by child
Views to enable state restoration on next session load:

```lua
---Serialize this view into a persistable state table.
---
---This method is called when the editor is saving workspace/session state.
---The returned table must contain only plain Lua data (no functions,
---userdata, metatables, or cyclic references).
---
---Returning `nil` indicates that this view should NOT be restored when
---reloading the workspace.
---
---@return table? state
function View:get_state()
  return nil
end

---Create and initialize a new view instance from a previously saved state.
---
---This function is called when restoring workspace/session state.
---Implementations are responsible for:
---  * creating the view instance
---  * applying any persisted state
---
---If loading the instance failed nil will be returned.
---
---@param state table
---@return core.view? view
function View.from_state(state)
  return nil
end
```

These functionality was implemented on DocView and ImageView.

:::note
Views that do not provide implementation of these methods will no longer be
automatically reloaded on subsequent editor launches.
:::

Another new method is `View:get_module()` which allows to easily fetch the
module associated to the current View child:

```lua
---Returns the module path of this view.
---
---This method resolves the Lua module name that loaded the concrete view
---class (for example `"core.view"`).
---
---If the view class cannot be associated with any loaded module, `nil`
---is returned.
---
---@return string? path
function View:get_module() end
```

## Image Loading Improvements

A new function was added to more easily allow opening images on the viewer and
text files on the document viewer:

```lua
---Opens the given file path in the root view.
---If the given file is a supported image, it will open it in the image viewer;
---otherwise, it will open it as a normal text file.
---@param filename string Path to the file to open
---@return core.imageview|core.docview
function core.open_file(filename) end
```

This function is now been use on find files plugin and other places that need
to load files into the editor.

Also thanks to [tacf](https://github.com/tacf) xpm joins svg as one of the image
formats that is allowed to be opened as a text file from within the TreeView.

![open in editor](https://github.com/user-attachments/assets/977db19b-583d-47de-ba67-1bc24eb93a2e)

## UI Improvements

Thanks to [juliardi](https://github.com/juliardi) (the evangelist) a button was
added to the toolbar and settings plugins tab to more easily access the plugin manager:

<video muted style={{width: '100%'}} controls>
  <source src="https://github.com/user-attachments/assets/3ab7b45f-93bb-4fd9-b69a-b16afce59211"/>
</video>

The scale plugin now keeps previous scale factor on editor restart and even
on sub-instances launched thru main editor since an internal environment
variable is been use for this purpose.

Also, the renderer cache cell size was reduced to improve detection of dirty
regions, the code related to this change was documented and re-arranged
for clearness and the convenience of future contributors.

**Before**

```c
#define RENCACHE_CELLS_X 80
#define RENCACHE_CELLS_Y 50
#define RENCACHE_CELL_SIZE 96
```

![before cell size](https://github.com/user-attachments/assets/7e2ce9c5-ede8-41ea-a487-42b829831483)

**After**

```c
/* These values represent the maximum size that can be tracked by rencache
   7680x4320 = 8k resolution, we use a common divisor for the size of regions
   that will be dirty checked.
*/
#define RENCACHE_CELL_SIZE 60 /* common divisor of width and height */
#define RENCACHE_CELLS_X (7680 / RENCACHE_CELL_SIZE) /* 128 cells */
#define RENCACHE_CELLS_Y (4320 / RENCACHE_CELL_SIZE) /* 72 cells */
```

![after cell size](https://github.com/user-attachments/assets/7fb0fad1-1c03-46f9-882e-b2eac0be47f1)

Two new variants of monokai were introduced:

* monokai-pro - thanks to [suxragi](https://github.com/suxragi)
* monokai-varied - forgot who gave me this one, thank you too!

## Additional Improvements

More Lua doc comments were added thanks to [Amer](https://github.com/AmerM137)
which allows better LSP code completion when working with the editor source
code as better generation of the [API reference](https://pragtical.dev/docs/category/api)
exposed on the website.

Also, Thanks to our testing [Ninja](https://github.com/AmerM137) the following
bugs where corrected:

* Wrong scale factor detection on Windows
* EmptyView widgets not properly positioned when transitions are turned off.

Fixed a documentation bug on DirMonitor thanks to [Walkero](https://github.com/walkero-gr),
also proper cleaning of watched directories on backends like kqueue.

Correction to the context menu sizing on 4K displays thanks also to
[tacf](https://github.com/tacf):

**Before**

![before context menu 1](https://github.com/user-attachments/assets/837cf738-d4c6-46ef-9a41-29f202118276)
![before context menu 2](https://github.com/user-attachments/assets/976b876d-e750-4ce1-a5a1-abb5ad2b0d9a)
![before context menu 3](https://github.com/user-attachments/assets/cf85f0e2-e0df-4dfa-b899-4e09ca00055a)

**After**

![after context menu 1](https://github.com/user-attachments/assets/3f556e16-7224-4671-ad10-99b0037af0be)
![after context menu 2](https://github.com/user-attachments/assets/cd1979c2-d6dd-4c2d-a147-9cb6ec29fddf)
![after context menu 3](https://github.com/user-attachments/assets/21e08cc6-5eb6-4c7d-a589-854c72693ae8)

On the build/CI system front, now the generated profiler guided optimizations
are been really used on clang builds AKA macOS builds, so crossing fingers and
hoping that now it works xD. Other optimizations were done to the CI like
defaulting to optimization level 3, installation of additional LuaJIT modules
and building of LuaJIT in amalgamation mode. Also, sdl and sdl_image were
updated both to v3.4.0, finally, the CI Linux AArch64 builds will require glibc
version 2.29 since the newer dependency versions introduced a requirement on
`posix_spawn_file_actions_addchdir_np` for this architecture.

Other fixes and improvements on the changes log below, enjoy!

Downloads on [GitHub](https://github.com/pragtical/pragtical/releases/tag/v3.8.2).

## Changes Log

### New Features

* Add view state save/load support
  ([#409](https://github.com/pragtical/pragtical/pull/409))

### Enhancements

* Documentation
  ([#396](https://github.com/pragtical/pragtical/pull/396))

* Open images in viewer from open file operations
  ([#403](https://github.com/pragtical/pragtical/pull/403))

* core.step: deprioritize only the mousemove event
  ([#407](https://github.com/pragtical/pragtical/pull/407))

* Add xpm as additional open as text format
  ([#410](https://github.com/pragtical/pragtical/pull/410))

### UI Enhancements

* scale plugin: keep current scale state on restart
  ([#401](https://github.com/pragtical/pragtical/pull/401))

* Reduce rencache cell size for better dirty detect
  ([#405](https://github.com/pragtical/pragtical/pull/405))

* add button for opening plugin manager from settings and toolbarview
  ([#408](https://github.com/pragtical/pragtical/pull/408))

* Made plugin manager button more subtle on settings ui
  ([40b0287e](https://github.com/pragtical/pragtical/commit/40b0287e333dafe95d028531d7c33d68b7aa6f34))

### Fixes

* common.dirname: treat leading / as directory name
  ([#400](https://github.com/pragtical/pragtical/pull/400))

* Reorder current/default scales on get_display_info
  ([#402](https://github.com/pragtical/pragtical/pull/402))

* EmptyView: re-update childs on size/pos changes
  ([#404](https://github.com/pragtical/pragtical/pull/404))

* DirMonitor: fix doc comment error
  ([#406](https://github.com/pragtical/pragtical/pull/406))

* fix: context menu not properly sized
  ([#411](https://github.com/pragtical/pragtical/pull/411))

### Build System

* CI: really use profiler data when compiling with clang
  ([30c734ab](https://github.com/pragtical/pragtical/commit/30c734abd630d188ff98fb19ea5d208ee2c15b64))

* CI: always use optimization level 3
  ([ac6395f8](https://github.com/pragtical/pragtical/commit/ac6395f8a10683c08feba611bb327207d624812e))

* Build luajit subproject in amalgamation mode.
  ([#390](https://github.com/pragtical/pragtical/pull/390))

* LuaJIT subproject: install additional lua modules
  ([#391](https://github.com/pragtical/pragtical/pull/391))

* Update colors subproject for more monokai variations
  ([#392](https://github.com/pragtical/pragtical/pull/392))

* Update SDL and SDL_image to v3.4.0
  ([#413](https://github.com/pragtical/pragtical/pull/413))

* CI: fix polyfill-glibc on Linux AArch64 (bumps required glibc to v2.29)
  ([ed651cea](https://github.com/pragtical/pragtical/commit/ed651cea3acf58d1ec8863f88276895ffd70e484))
