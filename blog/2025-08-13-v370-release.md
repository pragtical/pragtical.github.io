---
slug: pragtical-v370-release
title: Pragtical v3.7.0 Release
authors: jgmdev
---

Better colors, better performance, new Diff Viewer, SDL3 port and a seasoned
dosage of new features, fixes and enhancements!

Many of the new features and fixes on this release are possible thanks to all
the help, suggestions and testing provided by [Amer](https://github.com/AmerM137).

## Diff Viewer

One of the most exciting features on this release is the new file and
strings differences viewer that was suggested by
[bananakid](https://github.com/bananakid), who also provided testing and useful
feedback, Thank You!

Here is a preview of the viewer and configuration settings:

![diff viewer](https://github.com/user-attachments/assets/a8e5e42b-0688-41d5-8f4f-2f68acfdf482)

<!-- truncate -->

![diff viewer settings+](https://github.com/user-attachments/assets/8fbdf60c-43f7-4320-98da-44d58b1a231d)

**Short video preview of the Diff Viewer:**

<video autoplay muted loop style={{width: '100%'}} controls>
  <source src="https://github.com/user-attachments/assets/f5856c26-be2b-44f4-8d68-73b472fb90e9"/>
</video>

**New styles that can be set by color themes:**

```lua
style.diff_delete = { common.color "rgba(200, 84, 84, 1)" }
style.diff_insert = { common.color "rgba(77, 127, 73, 1)" }
style.diff_modify = { common.color "rgba(202, 173, 85, 1)" }
style.diff_delete_background = { common.color "rgba(200, 84, 84, 0.30)" }
style.diff_insert_background = { common.color "rgba(77, 127, 73, 0.30)" }
style.diff_modify_background = { common.color "rgba(202, 173, 85, 0.30)" }
style.diff_delete_inline = { common.color "rgba(200, 84, 84, 0.40)" }
style.diff_insert_inline = { common.color "rgba(77, 127, 73, 0.40)" }
```

## Better Colors

This release ships with a bunch of improvements and corrections to the
color themes courtesy of [Amer](https://github.com/AmerM137) who also raised
the subject of search selection highlights not been eye friendly. For this,
we now introduced the ability of having a different highlight color for
search selections as seen below:

<video autoplay muted loop style={{width: '100%'}} controls>
  <source src="https://github.com/user-attachments/assets/097a96b0-e80e-4664-ba17-09d1fe23d737"/>
</video>

New style fields introduced with this change that can be set by color themes:

* `style.search_selection` - background color of the selection
* `style.search_selection_text` - foreground (text) color of selection

Also, we got the **nightfox** family of color themes thanks to ranjan.

## New Config Options

We added some new config options that let you modify some aspects of the editor.
These configuration options are:

```lua
---Draw the current FPS, the average frame time, and the maximum time that
---coroutines have to run per frame without affecting the rendering process
---plus the total amount of running coroutines. If set to 'uncapped' the system
---will draw at the maximum speed per second for benchmarking purposes.
---
---Defaults to false.
---@type boolean | "uncapped"
config.draw_stats = false

---Perform case insensitive next word selection.
---
---The default is false.
---@type boolean
config.select_add_next_no_case = false

---Minimum number of lines to keep visible above and below the cursor
---when scrolling the document.
---
---The default is 10
---@type integer
config.scroll_context_lines = 10

---Show or hide the line numbers.
---
---The default is true
---@type boolean
config.show_line_numbers = true
```

Some previews on the effect of the config flags:

**config.draw_stats**
![draw_stats](https://github.com/user-attachments/assets/56dd291d-8918-4ff3-a0d0-5b63f21fa9e3)

**config.select_add_next_no_case**
<video autoplay muted loop style={{width: '100%'}} controls>
  <source src="https://github.com/user-attachments/assets/12870d5c-105a-4e82-a3c1-6937a3b0fd8a"/>
</video>

**config.scroll_context_lines**
<video autoplay muted loop style={{width: '100%'}} controls>
  <source src="https://github.com/user-attachments/assets/1ae403a5-c260-49c8-9915-c846f546eb5d"/>
</video>

All these configuration options are also accessible from the Settings UI.

## UI Improvements

One feature mostly unknown by users is the ability to search for a line
of code on current document using the goto line command. Syntax coloring
was added to the shown results:

<video autoplay muted loop style={{width: '100%'}} controls>
  <source src="https://github.com/user-attachments/assets/095801d2-3844-4f68-a882-fd3890558238"/>
</video>

Welcome page is responsive:

<video autoplay muted loop style={{width: '100%'}} controls>
  <source src="https://github.com/user-attachments/assets/3d622bdf-95bd-4fbd-a335-f2f35df5ffd7"/>
</video>

## REPL History and Completion Support

The previous release added a new REPL to easily interface with the Pragtical
runtime from the CLI. This release improves the REPL by adding history and
completion support that also works on Windows thanks to the lua linenoise
wrapper which I forked in order to integrate it with linenoise-ng, fixing
various segmentation faults and bugs. Finally, multiple return values are
properly handled now as seen on the video below:

<video autoplay muted loop style={{width: '100%'}} controls>
  <source src="https://github.com/user-attachments/assets/ec9491b9-3f80-4d14-9f1e-29544942e2b0"/>
</video>

## Performance Galore

Now, the officially distributed binary builds are generated using
**Profiler Guided Optimizations** and **Link Time Optimizations** to get
some better performance. For PGO I introduced a lua stress script to
generate the profiler data by running various tasks like: text editing,
tokenizing, scale changes, rect drawing, multiple process launching, etc...

LuaJIT FFI is now been used to call into some of the most hot C functions
used at runtime in order to reduce the calling overhead produced by the Lua
C API by up to 90%.

Also, the node system was modified to only perform updates on active views
and draw only the visible ones. This improves performance when having multiple
documents open at once.

A performance regression that was introduced with the fonts defer bitmap
feature was fixed thanks to reproducible test data provided by Amer. Pinpointing
the issue took some profiling and analyzing but it was finally fixed resulting
on snappier editor performance when opening files containing whitespace
characters.

The `config.fps` flag is now better respected since the rendering system will
not go much higher from the set value. Before, setting a value of 60 would not
have much effect with total frames per second surpassing this value by the
hundreds on forced redraws or received events, now, the max fps should be
more aligned to the configured amount.

Other performance improvements are listed on the change log!

## Core Additions

Some new methods made it in the core to help on the performance and code
duplication reduction departments.

```lua
---Get an estimated range of visible columns. It is an estimate because fonts
---and their fallbacks may not be monospaced or may differ in size. This
---function provides a way of optimization on really long lines for plugins
---that perform drawing operations on them.
---
---It is good practice to set the `extra_cols` parameter to a value that leaves
---room for the differences in font sizes.
---@param line integer
---@param extra_cols? integer Amount of columns to deduce on col1 and include on col2 (default: 100)
---@return integer col1
---@return integer col2
---@return integer ucol1
---@return integer ucol2
function DocView:get_visible_cols_range(line, extra_cols) end

---Open the given resource using the system launcher.
---The resource can be an url, file or directory in most cases...
---@param resource string
---@return boolean success
function common.open_in_system(resource) end
```

We truly needed `common.open_in_system`!

## Other Changes

Finally the SDL3 Port was merged after various testing.

The project module settings are now reset on project change.

Dropped from official builds macOS universal bundle and Windows 32 bits.

A borderless mode bug was spotted on macOS some time ago by
[dilpreetsio](https://github.com/dilpreetsio) and finally fixed thanks to
the feedback provided by [sfesenko](https://github.com/sfesenko).

Various other enhancements and fixes are part of this release but, I'm getting
lazy summarizing them and this post is getting long. Check the changes log
below for more details.

Downloads on [GitHub](https://github.com/pragtical/pragtical/releases/tag/v3.7.0).

## Changes Log

### New Features

* Add option to draw rendering stats
  ([#291](https://github.com/pragtical/pragtical/pull/291))

* REPL history and completion support
  ([#287](https://github.com/pragtical/pragtical/pull/287))

* Configurable amount of context lines visible on scroll
  ([#311](https://github.com/pragtical/pragtical/pull/311))

* Add built-in config to toggle line numbers
  ([#316](https://github.com/pragtical/pragtical/pull/316))

* Add config option for insensitive next word selection
  ([#332](https://github.com/pragtical/pragtical/pull/332))

* New Diff Viewer for built-in support of file and string comparisons
  ([#306](https://github.com/pragtical/pragtical/pull/306))

* Add common.open_in_system(resource) function
  ([#321](https://github.com/pragtical/pragtical/pull/321))

* SDL3 port
  ([#254](https://github.com/pragtical/pragtical/pull/254))

### Colors

* Add special highlight colors to search selections
  ([#312](https://github.com/pragtical/pragtical/pull/312))

* add search highlight styles to pre-packaged themes
  ([#315](https://github.com/pragtical/pragtical/pull/315))

* Add search selection styles to extra color themes
  ([colors/#2](https://github.com/pragtical/colors/pull/2))

* Improve contrast for default themes
  ([#322](https://github.com/pragtical/pragtical/pull/322))

* Improve contrast on extra themes
  ([colors/#5](https://github.com/pragtical/colors/pull/5))

* Added new nightfox family of color themes
  ([538d0424](https://github.com/pragtical/colors/commit/538d0424ea398f0a3db062d6ff472c36c5105b97))

### Fixes

* Fix common.color returning rgba values as strings
  ([#289](https://github.com/pragtical/pragtical/pull/289))

* Handle incomplete token type
  ([#295](https://github.com/pragtical/pragtical/pull/295))

* fix for tokenizer plugins not providing state
  ([fb56c461](https://github.com/pragtical/pragtical/commit/fb56c461f876ba2431c6d18fdcec6fee5825780f))

* borderless: scale window hit test info
  ([#303](https://github.com/pragtical/pragtical/pull/303))

* findfile: take into consideration subdirectories
  ([#325](https://github.com/pragtical/pragtical/pull/325))

* Reset previous project module settings on change
  ([#329](https://github.com/pragtical/pragtical/pull/329))

* projectsearch: restore docview focus on hidden treeview
  ([#331](https://github.com/pragtical/pragtical/pull/331))

### Enhancements

* language_lua: add c syntax coloring to ffi.cdef
  ([#290](https://github.com/pragtical/pragtical/pull/290))

* autocomplete: on max symbols return syntax_symbols
  ([#294](https://github.com/pragtical/pragtical/pull/294))

* settings ui: allow lowering line height to 0.8
  ([#299](https://github.com/pragtical/pragtical/pull/299))

* Make welcome page responsive
  ([#300](https://github.com/pragtical/pragtical/pull/300))

* Scale treeview and projectsearch size on scale changes
  ([#304](https://github.com/pragtical/pragtical/pull/304))

* Search UI: also scroll horizontally
  ([#310](https://github.com/pragtical/pragtical/pull/310))

* doc:go-to-line: live syntax preview
  ([#314](https://github.com/pragtical/pragtical/pull/314))

### Performance

* Use LuaJIT FFI to perform draw calls
  ([#288](https://github.com/pragtical/pragtical/pull/288))

* Limit FPS to match config.fps even during frequent events
  ([#293](https://github.com/pragtical/pragtical/pull/293))

* Add DocView:get_visible_cols_range(...)
  ([#296](https://github.com/pragtical/pragtical/pull/296))

* Revert "drawwhitespace: Cache whitespace location"
  ([#302](https://github.com/pragtical/pragtical/pull/302))

* luajit: arm64 patch to increase mcode alloc size
  ([#301](https://github.com/pragtical/pragtical/pull/301))

* Only update active views and draw visible ones
  ([#307](https://github.com/pragtical/pragtical/pull/307))

* Lower frame rate only after 3 consecutive drops
  ([#308](https://github.com/pragtical/pragtical/pull/308))

* Don't use incremental gc on Lua 5.4+
  ([#309](https://github.com/pragtical/pragtical/pull/309))

* Improve core.run() timings.
  ([#313](https://github.com/pragtical/pragtical/pull/313))

* Revert back to performant iterator on each_token
  ([#317](https://github.com/pragtical/pragtical/pull/317))

* Move inner functions to outer on tokenizer.tokenize
  ([#318](https://github.com/pragtical/pragtical/pull/318))

* Fix performance regression on defer bitmap
  ([#326](https://github.com/pragtical/pragtical/pull/326))

### Build System

* Add PGO Stress Generator Script, release and rolling builds are now
  PGO optimized, dropped macOS universal bundles and Windows 32 bit builds
  ([#320](https://github.com/pragtical/pragtical/pull/320))

### Widgets

* Added alpha slider to colorpicker widget

* Make use of new container widget on settings UI installed plugins
  and also on the EmptyView

* Added color reference support and make use of it on ListBox
